{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,oDAQAC,EAAAC,KAAKC,KAAKC,iBAAiB,UAmE3B,SAAsBC,GACpBA,EAAMC,iBAEN,MAAMC,EAAaF,EAAMG,OAAOC,SAASC,YAAYC,MAErD,IAAKJ,EAAWK,QAAUL,IAAeM,EACvC,OAAOd,EAAAe,OAAOC,QAAQ,oCAExBF,EAAcN,EACdS,EAAa,EAEbf,EAAAC,KAAKe,QAAQC,UAAY,GAEzBC,EAAUN,EAAaG,GAEvBf,EAAAC,KAAKC,KAAKiB,O,IAhFZ,IACIJ,EADAH,EAAc,GAGlB,MAAMQ,EAAW,IAAIC,EAAAC,GAAJ,CAAmB,aAAc,CAChDC,eAAgB,GAChBC,aAAc,MAGVC,EAAW,IAAIC,sBACnBC,IACEA,EAAQC,SAAQC,IACVA,EAAMC,iBACRC,QAAQC,IAAIH,GACZX,EAAUN,EAAaG,G,GAEzB,GAEJ,CACEkB,KAAM,KACNC,WAAY,QACZC,UAAW,IAIfC,eAAelB,EAAUmB,EAAGC,GAC1B,IACE,MAAMC,QAAa,EAAAC,EAAAC,kBAAiBJ,EAAGC,GAIvC,GAHAP,QAAQC,IAAIO,EAAKG,MACjBX,QAAQC,IAAIO,IAEPA,EAAKI,UAIR,YAHA7C,EAAAe,OAAO+B,QACL,6EAKJ,EAAAC,EAAAC,cAAaP,EAAKG,MAElBtB,EAAS2B,UAEU,IAAfhC,GACFjB,EAAAe,OAAOmC,QAAQ,oBAAoBT,EAAKI,qBAG1C,MAAMM,EAAWC,KAAKC,KAAKZ,EAAKI,UAAY,IAE5C,GAAI5B,IAAekC,EAMf,OAJAxB,EAAS2B,UAAUpD,EAAAC,KAAKoD,YACxBvD,EAAAe,OAAOyC,KACL,8DAMNvC,GAAc,EACdU,EAAS8B,QAAQvD,EAAAC,KAAKoD,M,CACtB,MAAOG,GACPzB,QAAQC,IAAIwB,GACZ1D,EAAAe,OAAO+B,QAAQ,oD","sources":["src/js/02-scroll.js"],"sourcesContent":["import { Notify } from 'notiflix';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { fetchPixabayData } from './pixabay-api';\nimport { createMarkup } from './markup';\nimport { refs } from './refs';\n\nrefs.form.addEventListener('submit', onFormSubmit);\n\nlet searchQuery = '';\nlet searchPage;\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  overlayOpacity: 0.5,\n  captionDelay: 250,\n});\n\nconst observer = new IntersectionObserver(\n  entries => {\n    entries.forEach(entry => {\n      if (entry.isIntersecting) {\n        console.log(entry);\n        getImages(searchQuery, searchPage);\n      }\n    });\n  },\n  {\n    root: null,\n    rootMargin: '100px',\n    threshold: 1.0,\n  }\n);\n\nasync function getImages(q, pages) {\n  try {\n    const data = await fetchPixabayData(q, pages);\n    console.log(data.hits);\n    console.log(data);\n\n    if (!data.totalHits) {\n      Notify.failure(\n        'Sorry, there are no images matching your search query. Please try again.'\n      );\n      return;\n    }\n\n    createMarkup(data.hits);\n\n    lightbox.refresh();\n\n    if (searchPage === 1) {\n      Notify.success(`Hooray! We found ${data.totalHits} images.`);\n    }\n\n    const lastPage = Math.ceil(data.totalHits / 40);\n\n    if (searchPage === lastPage) {\n      {\n        observer.unobserve(refs.guard);\n        Notify.info(\n          `We're sorry, but you've reached the end of search results.`\n        );\n        return;\n      }\n    }\n\n    searchPage += 1;\n    observer.observe(refs.guard);\n  } catch (error) {\n    console.log(error);\n    Notify.failure(`Ooops... Something goes wrong. Please, try again.`);\n  }\n}\n\nfunction onFormSubmit(event) {\n  event.preventDefault();\n\n  const inputValue = event.target.elements.searchQuery.value;\n\n  if (!inputValue.trim() || inputValue === searchQuery)\n    return Notify.warning('Please enter something to search');\n\n  searchQuery = inputValue;\n  searchPage = 1;\n\n  refs.gallery.innerHTML = '';\n\n  getImages(searchQuery, searchPage);\n\n  refs.form.reset();\n}\n"],"names":["$7Y9D8","parcelRequire","$krGWQ","refs","form","addEventListener","event","preventDefault","inputValue","target","elements","searchQuery","value","trim","$0943ba9843123748$var$searchQuery","Notify","warning","$0943ba9843123748$var$searchPage","gallery","innerHTML","$0943ba9843123748$var$getImages","reset","$0943ba9843123748$var$lightbox","$parcel$interopDefault","$fZKcF","overlayOpacity","captionDelay","$0943ba9843123748$var$observer","IntersectionObserver","entries","forEach","entry","isIntersecting","console","log","root","rootMargin","threshold","async","q","pages","data","$6fOXY","fetchPixabayData","hits","totalHits","failure","$3huUq","createMarkup","refresh","success","lastPage","Math","ceil","unobserve","guard","info","observe","error"],"version":3,"file":"02-scroll.1aafb542.js.map"}